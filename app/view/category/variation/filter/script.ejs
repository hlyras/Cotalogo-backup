<script>
  document.getElementById("variation-filter-form").addEventListener("submit", async event => {
    event.preventDefault();

    let variation = {
      name: event.target.elements.namedItem("name").value,
      category_id: event.target.elements.namedItem("category-id").value
    };

    let variations = await API.response(Variation.filter, variation);
    if (!variations) { return false; }

    variationFilter(variations);
  });

  function variationFilter(variations) {
    let filter_box = document.getElementById("variation-filter-box");
    let filter_div = document.getElementById("variation-filter-div");
    filter_div.innerHTML = "";

    if (variations.length) {
      let div_header = lib.element.create("div", { class: "box b1 container border em07 center" });

      div_header.appendChild(lib.element.create("div", { class: "mobile-box b4-5 padding-5 bold noselect" }, "Nome"));
      filter_div.appendChild(div_header);

      variations.forEach(variation => {
        let div_variation = lib.element.create("div", { class: "box b1 container box-hover padding-5 margin-top-5 border" });

        div_variation.appendChild(lib.element.create("div", { class: "mobile-box b8-10 center" }, variation.name));
        div_variation.appendChild(lib.element.icon('b10', 20, "/images/icon/edit.png", `variationEdit(${variation.id})`));
        div_variation.appendChild(lib.element.icon('b10', 20, "/images/icon/trash.png", `variationDelete(${variation.id})`));
        filter_div.appendChild(div_variation);
      });
      filter_box.style.display = "";
    } else {
      let div_variation = lib.element.create("div", { class: "box b1 center box-hover padding-5 border" }, "Sem resultados");
      filter_div.appendChild(div_variation);
      filter_box.style.display = "";
    };
  };

  const variationEdit = async (variation_id) => {
    let variation = await API.response(Variation.filter, { id: variation_id });
    if (!variation) { return false; }

    document.getElementById("variation-create-form").elements.namedItem("id").value = variation[0].id;
    document.getElementById("variation-create-form").elements.namedItem("name").value = variation[0].name;
    document.getElementById("variation-create-form").elements.namedItem("name").focus();

    lib.display("variation-create-form", '');
  };

  const variationDelete = async (variation_id) => {
    let r = confirm('Deseja realmente excluir a variação?');
    if (r) {
      if (!await API.response(Variation.delete, variation_id)) { return false; };
      document.getElementById("variation-filter-form").submit.click();
    }
  };
</script>
<script>
  // const business_name = document.getElementById("catalog-create-form").business_name.value;
  const business_name = document.getElementById("catalog-create-form").url.value.slice(12, document.getElementById("catalog-create-form").url.value.length - 1);
  // const boldText = "<b>" + text.slice(startIndex) + "</b>";

  document.getElementById("catalog-create-form").url.addEventListener("input", function (e) {
    if (lib.hasForbiddenChar(event.data)) {
      this.value = this.value.slice(0, this.value.length - 1);
      return alert("Simbolo não permitido em uma URL.");
    }

    if (this.value.length < 12 + business_name.length + 1) {
      this.value = `cotalogo.com${business_name}/`
    }

    this.value = this.value.toLowerCase();
  });

  document.getElementById("catalog-create-form").addEventListener("submit", async e => {
    e.preventDefault();

    // if (lib.hasForbiddenChar(e.target.url.value.slice(12 + business_name.length + 1))) { return alert("O endereço é inválido."); }

    const catalog = {
      id: e.target.id.value,
      url: e.target.url.value.slice(12 + business_name.length).toLowerCase()
    };

    let response = await API.response(Catalog.create, catalog);
    if (!response) { return false; }

    e.target.id.value = ``;
    e.target.url.value = `cotalogo.com${business_name}/`;

    lib.display("catalog-create-form", "none");
    document.getElementById("catalog-filter-expander").src = "/images/icon/retract.png";

    lib.display("catalog-filter-box", "");
    document.getElementById("catalog-create-expander").src = "/images/icon/expand.png";

    document.getElementById("catalog-create-label").innerHTML = "Novo catálogo";
    document.getElementById("catalog-create-form").submit.value = "Criar catálogo";

    document.getElementById("catalog-filter-form").submit.click();
  });

  async function catalogEdit(catalog_id) {
    let catalog = await API.response(Catalog.findById, catalog_id);
    if (!catalog) { return false; }

    lib.display("catalog-filter-box", "none");
    document.getElementById("catalog-filter-expander").src = "/images/icon/expand.png";
    document.getElementById("catalog-filter-box").scrollIntoView();

    lib.display("catalog-create-form", "");
    document.getElementById("catalog-create-expander").src = "/images/icon/retract.png";

    document.getElementById("catalog-create-form").id.value = catalog.id;
    document.getElementById("catalog-create-form").url.value = `cotalogo.com/${business_name}${catalog.url}`;

    document.getElementById("catalog-create-label").innerHTML = "Atualizar catálogo";
    document.getElementById("catalog-create-form").submit.value = "Atualizar catálogo";
  };
</script>